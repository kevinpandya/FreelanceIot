<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HomeController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">controllers</a> &gt; <span class="el_source">HomeController.java</span></div><h1>HomeController.java</h1><pre class="source lang-java linenums">package controllers;

import actors.*;
import akka.actor.ActorRef;
import akka.actor.ActorSystem;
import akka.stream.Materializer;
import businesslogic.SearchFleschIndex;
import businesslogic.SearchPhrase;
import businesslogic.Session;
import model.Profile;
import model.Resultlist;
import play.libs.streams.ActorFlow;
import play.mvc.Controller;
import play.mvc.Http;
import play.mvc.Result;
import play.mvc.WebSocket;
import scala.compat.java8.FutureConverters;

import javax.inject.Inject;
import java.util.LinkedHashMap;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;

import static akka.pattern.Patterns.ask;

/**
 * This controller contains an action to handle HTTP requests
 * to the application's home page.
 * @author Group Task
 */
public class HomeController extends Controller {

<span class="fc" id="L33">	LinkedHashMap&lt;String, Resultlist&gt; resultmap = new LinkedHashMap&lt;String, Resultlist&gt;();</span>
<span class="fc" id="L34">	LinkedHashMap&lt;String, Integer&gt; indStats = new LinkedHashMap&lt;String, Integer&gt;();</span>
<span class="fc" id="L35">	LinkedHashMap&lt;String, Profile&gt; usermap = new LinkedHashMap&lt;String, Profile&gt;();</span>
//	SearchPhrase searchphrase = new SearchPhrase();
//  SearchSkill searchskill = new SearchSkill();
//	WordStats wordStats = new WordStats();
//	SearchProfile searchprofile = new SearchProfile();
<span class="fc" id="L40">	SearchFleschIndex sfi = new SearchFleschIndex();</span>
<span class="fc" id="L41">    Session session = new Session();</span>

<span class="fc" id="L43">	@Inject</span>
<span class="fc" id="L44">	ActorSystem system = ActorSystem.create(&quot;FreeLancelot&quot;);</span>

	private ActorRef searchPhraseActor;
//	private ActorRef childSearchPhraseActor;
//	private ActorRef searchResultActor;
	private final ActorRef profileActor;
	private final ActorRef skillActor;
	private final ActorRef statsActor;
	private final ActorRef fleschActor;
	private final Materializer materializer;
//	ActorRef Useractor;
//	private final LoggingAdapter log = Logging.getLogger(getContext().getSystem(), this);


	@Inject
<span class="fc" id="L59">	public HomeController(ActorSystem system, Materializer materializer) {</span>
		//this.searchPhraseActor = system.actorOf(SearchPhrase.getProps());
//		this.searchResultActor = system.actorOf(SearchResultActor.getProps());
<span class="fc" id="L62">		this.profileActor = system.actorOf(SearchProfileActor.getProps());</span>
<span class="fc" id="L63">		this.skillActor = system.actorOf(SearchSkillActor.getProps());</span>
<span class="fc" id="L64">		this.statsActor = system.actorOf(WordStatsActor.getProps());</span>
<span class="fc" id="L65">		this.fleschActor = system.actorOf(SearchFleschIndexActor.getProps());</span>
<span class="fc" id="L66">		this.materializer = materializer;</span>
<span class="fc" id="L67">	}</span>


	/**
	 * An action that renders an HTML page with a welcome message.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/&lt;/code&gt;.
	 * @param searchPhraseString Search string entered by user
	 * @return Loads the html page containing the search results
	 */


	public WebSocket socket() {
<span class="nc" id="L81">		return WebSocket.Text.accept(request -&gt; ActorFlow.actorRef(WebSocketActor::props, system, materializer));</span>
	}

    public CompletionStage&lt;Result&gt; index(Http.Request request,String searchPhraseString,String sessionId) {
<span class="fc bfc" id="L85" title="All 2 branches covered.">		if(searchPhraseString.equals(&quot;&quot;)) {</span>
<span class="fc" id="L86">			searchPhraseActor = null;</span>
<span class="fc" id="L87">        	return CompletableFuture.completedFuture(ok(views.html.index.render(request,null)));</span>
        }else {
<span class="fc bfc" id="L89" title="All 2 branches covered.">			if(searchPhraseActor == null){</span>
<span class="fc" id="L90">				searchPhraseActor = system.actorOf(SearchPhraseActor.props(sessionId));</span>
<span class="fc" id="L91">				System.out.println(&quot;[INFO] new Actor Created&quot;+searchPhraseActor);</span>
<span class="fc" id="L92">				session.setSession(sessionId,searchPhraseActor);</span>
			}else {
<span class="fc" id="L94">				searchPhraseActor = session.getSession(sessionId);</span>
			}
<span class="fc" id="L96">			System.out.println(&quot;\n\nSession Actor : &quot;+searchPhraseActor+&quot;\n\n&quot;);</span>
<span class="fc" id="L97">			return FutureConverters.toJava(ask(searchPhraseActor, searchPhraseString, Integer. MAX_VALUE))</span>
<span class="fc" id="L98">					.thenApply(response -&gt; {</span>
<span class="fc" id="L99">						LinkedHashMap&lt;String, Resultlist&gt; resultmap = null;</span>
						try{
<span class="fc" id="L101">							System.out.println(response);</span>
<span class="fc" id="L102">							resultmap = (LinkedHashMap&lt;String, Resultlist&gt;) response;</span>
<span class="nc" id="L103">						}catch(Exception e){</span>
<span class="nc" id="L104">							return ok(&quot;Internal Server Error&quot;);</span>
<span class="fc" id="L105">						}</span>
<span class="fc" id="L106">						return ok(views.html.index.render(request,resultmap));</span>
					});
    	}
		//    		if(searchPhraseActor == null) {
//				searchphrase = new SearchPhrase();
//				session.setSession(sessionId,searchPhraseActor);
//			}else{
//				searchphrase = session.getSession(sessionId,searchphrase);
//			}
		//CompletionStage&lt;LinkedHashMap&lt;String, Resultlist&gt;&gt; res = searchphrase.getResult(searchPhraseString);
		//return res.thenApplyAsync(o -&gt; ok(views.html.index.render(o)));
    }

	/**
	 * An action that renders an HTML page with projects list.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;skill/id/skill&lt;/code&gt;.
	 * @param id id of the given skill
	 * @return Redirects to the html page containing 10 latest projects of a given skill
	 */
    public CompletionStage&lt;Result&gt; skill(String id) {
<span class="fc" id="L128">		System.out.println(id);</span>
<span class="fc" id="L129">		return FutureConverters.toJava(ask(skillActor, id, Integer. MAX_VALUE))</span>
<span class="fc" id="L130">				.thenApply(response -&gt; {</span>
<span class="fc" id="L131">					LinkedHashMap&lt;String, Resultlist&gt; resultmap = null;</span>
					try{
<span class="fc" id="L133">						System.out.println(response);</span>
<span class="fc" id="L134">						resultmap = (LinkedHashMap&lt;String, Resultlist&gt;) response;</span>
<span class="nc" id="L135">					}catch(Exception e){</span>
<span class="nc" id="L136">						return ok(&quot;Internal Server Error&quot;);</span>
<span class="fc" id="L137">					}</span>
<span class="fc" id="L138">					return ok(views.html.OriginalSkill.render(resultmap));</span>
				});

//		CompletionStage&lt;LinkedHashMap&lt;String, Resultlist&gt;&gt; res = searchskill.getResult(id);
//    	return res.thenApplyAsync(o -&gt; ok(views.html.skill.render(o)));
    }

	/**
	 * An action that renders an HTML page with Word Stats of all the searched projects.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/wordstats/search&lt;/code&gt;.
	 * @param search Search string entered by user
	 * @return Redirects to the html page showing Word Stats for all the searched queries
	 */
	public CompletionStage&lt;Result&gt; wordStat(String search) {
		//System.out.println(&quot;In HomeController WordStats : &quot;+search);
//		CompletionStage&lt;LinkedHashMap&lt;String, Resultlist&gt;&gt; res = wordStats.getResult(search, searchphrase.resultmap.get(search).getDescriptions());
//		return res.thenApplyAsync(o -&gt; ok(views.html.stat.render(o)));
<span class="fc" id="L157">		return FutureConverters.toJava(ask(statsActor, SearchPhrase.resultmap.get(search).getDescriptions(), Integer.MAX_VALUE))</span>
<span class="fc" id="L158">				.thenApply(response -&gt; {</span>
<span class="fc" id="L159">					LinkedHashMap&lt;String, Resultlist&gt; resultmap = null;</span>
					try{
<span class="fc" id="L161">						resultmap = (LinkedHashMap&lt;String, Resultlist&gt;) response;</span>
<span class="nc" id="L162">					}catch(Exception e){</span>
<span class="nc" id="L163">						return ok(&quot;Internal Server Error&quot;);</span>
<span class="fc" id="L164">					}</span>
<span class="fc" id="L165">					return ok(views.html.stat.render(resultmap));</span>
				});
	}


	/**
	 * An action that renders an HTML page with Word Stats of an individual project.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/indvstats/search/index&lt;/code&gt;.
	 * @param search Search string entered by the user
	 * @param index Index of the individual project
	 * @return Redirects to the html page containing word stats of an individual project
	 */
	public CompletionStage&lt;Result&gt; indvStat(String search, int index) {
		//WordStats wordStats = new WordStats();
		//CompletionStage&lt;LinkedHashMap&lt;String, Integer&gt;&gt; res = wordStats.getStatResult(SearchPhrase.resultmap.get(search).getDescriptions().get(index));
		//return res.thenApplyAsync(o -&gt; ok(views.html.indvstat.render(o)));
<span class="fc" id="L183">		return FutureConverters.toJava(ask(statsActor, SearchPhrase.resultmap.get(search).getDescriptions().get(index), Integer.MAX_VALUE))</span>
<span class="fc" id="L184">				.thenApply(response -&gt; {</span>
					try{
<span class="fc" id="L186">						indStats = (LinkedHashMap&lt;String, Integer&gt;) response;</span>
<span class="nc" id="L187">					}catch(Exception e){</span>
<span class="nc" id="L188">						return ok(&quot;Internal Server Error&quot;);</span>
<span class="fc" id="L189">					}</span>
<span class="fc" id="L190">					return ok(views.html.indvstat.render(indStats));</span>
				});
	}

	/**
	 * An action that renders an HTML page with the details of an Employer.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/profile/id&lt;/code&gt;.
	 * @param id Owner Id of the employer
	 * @return Redirects to the html page showing details of an Employer
	 */
	public CompletionStage&lt;Result&gt; profile(String id) {
<span class="fc" id="L203">		return FutureConverters.toJava(ask(profileActor, id, Integer. MAX_VALUE))</span>
<span class="fc" id="L204">				.thenApply(response -&gt; {</span>
<span class="fc" id="L205">					LinkedHashMap&lt;String, Profile&gt; resultmap = null;</span>
					try{
<span class="fc" id="L207">						resultmap = (LinkedHashMap&lt;String, Profile&gt;) response;</span>
<span class="nc" id="L208">					}catch(Exception e){</span>
<span class="fc" id="L209">					}</span>
<span class="fc" id="L210">					return ok(views.html.profile.render(resultmap));</span>
				});

//		CompletionStage&lt;LinkedHashMap&lt;String, Profile&gt;&gt; res = searchprofile.getResult(id);
//		return res.thenApplyAsync(o -&gt; ok(views.html.profile.render(o)));
	}

	/**
	 * An action that renders an HTML page with the Flesch Readability Index of a project description.
	 * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
	 * this method will be called when the application receives a
	 * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/readability/search/index&lt;/code&gt;.
	 * @param search Search string entered by user
	 * @param index index of an individual project
	 * @return Redirects to the html page showing Flesch Readability Index of an individual project]
	 */
	public CompletionStage&lt;Result&gt; readability(String search, int index) {
<span class="fc" id="L227">		return FutureConverters.toJava(ask(fleschActor, SearchPhrase.resultmap.get(search).getDescriptions().get(index), Integer.MAX_VALUE))</span>
<span class="fc" id="L228">				.thenApply(response -&gt; {</span>
<span class="fc" id="L229">					LinkedHashMap&lt;String, String&gt; resultmap = null;</span>
					try{
<span class="fc" id="L231">						resultmap = (LinkedHashMap&lt;String, String&gt;) response;</span>
<span class="nc" id="L232">					}catch(Exception e){</span>
<span class="nc" id="L233">						return ok(&quot;Internal Server Error&quot;);</span>
<span class="fc" id="L234">					}</span>
<span class="fc" id="L235">					return ok(views.html.readability.render(resultmap));</span>
				});
//		CompletionStage&lt;LinkedHashMap&lt;String, String&gt;&gt; res = sfi.getResult(SearchPhrase.resultmap.get(search).getDescriptions().get(index));
//		return res.thenApplyAsync(o -&gt; ok(views.html.readability.render(o)));
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>